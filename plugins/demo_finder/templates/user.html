<div id="find-numbers-user" style="padding:20px;">
    <div id="waiting-view" style="text-align:center; padding:40px;">
        <h3 style="color: #666;">ğŸ“º è¯·è§‚çœ‹å¤§å±</h3>
        <p>å½“å‰é˜¶æ®µï¼š<span id="current-phase-text">å‡†å¤‡ä¸­...</span></p>
        <p style="color: #999;">è§‚å¯Ÿå¤§å±ä¸Šçš„æ•°å­—ï¼Œæ‰¾å‡ºç¼ºå¤±çš„æ•°å­—</p>
    </div>

    <div id="input-view" style="display:none;">
        <h3 style="margin-bottom: 10px;">ğŸ”¢ è¯·è¾“å…¥é˜¶æ®µ <span id="submit-phase-num"></span> ç¼ºå¤±çš„æ•°å­—</h3>
        <p style="color: #666; margin-bottom: 20px; font-size: 14px;">å…±ç¼ºå¤±10ä¸ªæ•°å­—ï¼Œè¯·å°½å¯èƒ½å¤šåœ°æ‰¾å‡ºæ¥</p>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
            <input type="number" class="number-input" placeholder="æ•°å­—1" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—2" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—3" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—4" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—5" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—6" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—7" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—8" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—9" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
            <input type="number" class="number-input" placeholder="æ•°å­—10" min="1" max="100"
                style="padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px;">
        </div>

        <button onclick="submitNumbers()" style="
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        ">æäº¤é˜¶æ®µ <span id="submit-phase-num2"></span> ç­”æ¡ˆ</button>

        <div id="submit-status" style="margin-top: 15px; text-align: center; color: #666;"></div>
    </div>
</div>

<script>
    let currentPhase = 0;
    let hasSubmittedPhase = { 1: false, 2: false, 3: false };

    // Listen for phase changes (we'll use custom event or polling)
    // For now, let's add a simple button for users to indicate they're ready
    function showInputForPhase(phase) {
        currentPhase = phase;

        // Check if already submitted for this phase
        if (hasSubmittedPhase[phase]) {
            document.getElementById('waiting-view').style.display = 'block';
            document.getElementById('input-view').style.display = 'none';
            document.getElementById('current-phase-text').innerText = `ç¬¬${phase}é˜¶æ®µ - å·²æäº¤`;
            return;
        }

        // Show input form
        document.getElementById('waiting-view').style.display = 'none';
        document.getElementById('input-view').style.display = 'block';
        document.getElementById('submit-phase-num').innerText = phase;
        document.getElementById('submit-phase-num2').innerText = phase;

        // Clear previous inputs
        document.querySelectorAll('.number-input').forEach(input => {
            input.value = '';
            input.disabled = false;
        });
        document.getElementById('submit-status').innerText = '';
    }

    // Add buttons to manually trigger input for each phase (temporary solution)
    const waitingView = document.getElementById('waiting-view');
    const buttonContainer = document.createElement('div');
    buttonContainer.style.cssText = 'margin-top: 30px; display: flex; gap: 10px; justify-content: center;';
    buttonContainer.innerHTML = `
        <button onclick="showInputForPhase(1)" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">é˜¶æ®µ1ç­”é¢˜</button>
        <button onclick="showInputForPhase(2)" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">é˜¶æ®µ2ç­”é¢˜</button>
        <button onclick="showInputForPhase(3)" style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">é˜¶æ®µ3ç­”é¢˜</button>
    `;
    waitingView.appendChild(buttonContainer);

    async function submitNumbers() {
        const inputs = document.querySelectorAll('.number-input');
        const numbers = [];

        inputs.forEach(input => {
            const val = parseInt(input.value);
            if (!isNaN(val) && val >= 1 && val <= 100) {
                numbers.push(val);
            }
        });

        if (numbers.length === 0) {
            alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæ•°å­—');
            return;
        }

        const statusDiv = document.getElementById('submit-status');
        statusDiv.innerText = 'æäº¤ä¸­...';

        try {
            const response = await fetch('/api/plugin/{{ interaction_id }}/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    phase: currentPhase,
                    submitted_numbers: numbers
                })
            });

            if (response.ok) {
                statusDiv.innerText = 'âœ… æäº¤æˆåŠŸï¼';
                statusDiv.style.color = 'green';
                hasSubmittedPhase[currentPhase] = true;

                // Disable inputs
                inputs.forEach(input => input.disabled = true);

                // Return to waiting view after 2 seconds
                setTimeout(() => {
                    document.getElementById('waiting-view').style.display = 'block';
                    document.getElementById('input-view').style.display = 'none';
                    document.getElementById('current-phase-text').innerText = `ç¬¬${currentPhase}é˜¶æ®µ - å·²æäº¤`;
                }, 2000);
            } else {
                statusDiv.innerText = 'âŒ æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•';
                statusDiv.style.color = 'red';
            }
        } catch (e) {
            console.error(e);
            statusDiv.innerText = 'âŒ ç½‘ç»œé”™è¯¯';
            statusDiv.style.color = 'red';
        }
    }
</script>